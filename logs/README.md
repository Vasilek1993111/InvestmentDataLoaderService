# Структура логов Investment Data Loader Service

## Обзор

Логи приложения организованы в структурированном виде для удобного мониторинга и анализа.

## Структура директорий

```
logs/
├── current/           # Текущие активные логи
│   ├── evening-session.log
│   ├── morning-session.log
│   ├── main-session.log
│   ├── instruments.log
│   ├── system.log
│   └── errors.log
├── archive/           # Архивные логи по датам
│   ├── 2025-10-21/
│   │   ├── evening-session.log
│   │   ├── morning-session.log
│   │   ├── main-session.log
│   │   ├── instruments.log
│   │   ├── system.log
│   │   └── errors.log
│   └── 2025-10-22/
│       └── ...
└── README.md         # Этот файл
```

## Типы логов

### 1. Вечерняя сессия (`evening-session.log`)
- Логи загрузки цен закрытия вечерней сессии
- Асинхронные операции вечерней сессии
- Статистика обработки акций и фьючерсов

### 2. Утренняя сессия (`morning-session.log`)
- Логи загрузки цен открытия утренней сессии
- Операции с утренними ценами
- Статистика утренних операций

### 3. Основная сессия (`main-session.log`)
- Логи основной торговой сессии
- Загрузка цен основной сессии
- Операции с основными инструментами

### 4. Инструменты (`instruments.log`)
- Логи работы с финансовыми инструментами
- Загрузка акций, фьючерсов, индикативов
- Кэширование инструментов

### 5. Системные логи (`system.log`)
- Общие системные операции
- Контроллеры (System, Status, Cache, Trading и др.)
- Сервисы и клиенты
- Планировщики

### 6. Ошибки (`errors.log`)
- Только ERROR уровень логирования
- Все ошибки приложения
- Исключения и критические проблемы

## Ротация логов

- **Текущие логи**: хранятся в `logs/current/`
- **Архивные логи**: автоматически перемещаются в `logs/archive/YYYY-MM-DD/`
- **Срок хранения**: 30 дней
- **Автоматическая очистка**: старые логи удаляются автоматически

## Мониторинг

### Просмотр текущих логов
```bash
# Все логи
tail -f logs/current/*.log

# Конкретный тип логов
tail -f logs/current/system.log
tail -f logs/current/errors.log
```

### Поиск по логам
```bash
# Поиск ошибок
grep -r "ERROR" logs/current/

# Поиск по дате
grep "2025-10-21" logs/current/system.log

# Поиск по компоненту
grep "SystemController" logs/current/system.log
```

### Анализ производительности
```bash
# Статистика по времени выполнения
grep "завершена за:" logs/current/evening-session.log

# Анализ ошибок
grep -c "ERROR" logs/current/errors.log
```

## Конфигурация

Настройки логирования находятся в `src/main/resources/logback-spring.xml`:

- **Уровни логирования**: INFO, DEBUG, ERROR
- **Формат логов**: `%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n`
- **Ротация**: ежедневная
- **Сжатие**: автоматическое
- **Размер файлов**: без ограничений

## Устранение неполадок

### Проблемы с дисковым пространством
```bash
# Проверка размера логов
du -sh logs/

# Очистка старых логов (старше 30 дней)
find logs/archive -type d -mtime +30 -exec rm -rf {} \;
```

### Проблемы с производительностью
- Увеличьте уровень логирования до WARN для продакшена
- Настройте асинхронное логирование для высоконагруженных систем
- Используйте фильтры для исключения избыточных логов

## Безопасность

- Логи могут содержать чувствительную информацию
- Ограничьте доступ к директории `logs/`
- Не логируйте пароли и токены
- Регулярно архивируйте и удаляйте старые логи
