# API ‚Äî –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–¥–µ–ª–∫–∏ (`/api/last-trades`)

## –û–±–∑–æ—Ä

API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã–º–∏ —Å–¥–µ–ª–∫–∞–º–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è:
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø–∞–º** - –∞–∫—Ü–∏–∏, —Ñ—å—é—á–µ—Ä—Å—ã, –≤—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –ø—É–ª–∞–º–∏ –ø–æ—Ç–æ–∫–æ–≤
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ taskId

**–ë–∞–∑–æ–≤—ã–π URL:** `http://localhost:8083/api/last-trades` (PROD) / `http://localhost:8087/api/last-trades` (TEST)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—É–ª–æ–≤ –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á
- **–ì–∏–±–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ GET –∏ POST –º–µ—Ç–æ–¥–æ–≤
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤ system_logs
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CachedInstrumentService

---

## POST /api/last-trades

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–¥–µ–ª–æ–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π JSON —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `figis` (body, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —Å–ø–∏—Å–æ–∫ FIGI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- `tradeSource` (body, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–¥–µ–ª–æ–∫

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
curl -X POST "http://localhost:8083/api/last-trades" \
  -H "Content-Type: application/json" \
  -d '{"figis": ["BBG004730N88", "BBG004730ZJ9"], "tradeSource": "TRADE_SOURCE_ALL"}'

# –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
curl -X POST "http://localhost:8083/api/last-trades" \
  -H "Content-Type: application/json" \
  -d '{"figis": ["ALL"], "tradeSource": "TRADE_SOURCE_ALL"}'
```

**–û—Ç–≤–µ—Ç (–ø—Ä–∏–º–µ—Ä):**
```json
{
  "success": true,
  "message": "–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ",
  "taskId": "LAST_TRADES_12345678",
  "timestamp": "2024-01-15T18:30:00"
}
```

---

## GET /api/last-trades

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–¥–µ–ª–æ–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `figis` (query, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —Å–ø–∏—Å–æ–∫ FIGI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
- `tradeSource` (query, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–¥–µ–ª–æ–∫

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
curl "http://localhost:8083/api/last-trades?figis=BBG004730N88,BBG004730ZJ9&tradeSource=TRADE_SOURCE_ALL"

# –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
curl "http://localhost:8083/api/last-trades?figis=ALL&tradeSource=TRADE_SOURCE_ALL"
```

**–û—Ç–≤–µ—Ç (–ø—Ä–∏–º–µ—Ä):**
```json
{
  "success": true,
  "message": "–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ",
  "taskId": "LAST_TRADES_87654321",
  "timestamp": "2024-01-15T18:30:00"
}
```

---

## GET /api/last-trades/shares

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–¥–µ–ª–æ–∫ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ü–∏–π.

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ —Å–¥–µ–ª–æ–∫ –ø–æ –∞–∫—Ü–∏—è–º
curl "http://localhost:8083/api/last-trades/shares"
```

**–û—Ç–≤–µ—Ç (–ø—Ä–∏–º–µ—Ä):**
```json
{
  "success": true,
  "message": "–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ",
  "taskId": "SHARES_12345678",
  "timestamp": "2024-01-15T18:30:00"
}
```

---

## GET /api/last-trades/futures

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–¥–µ–ª–æ–∫ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤.

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ —Å–¥–µ–ª–æ–∫ –ø–æ —Ñ—å—é—á–µ—Ä—Å–∞–º
curl "http://localhost:8083/api/last-trades/futures"
```

**–û—Ç–≤–µ—Ç (–ø—Ä–∏–º–µ—Ä):**
```json
{
  "success": true,
  "message": "–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ",
  "taskId": "FUTURES_87654321",
  "timestamp": "2024-01-15T18:30:00"
}
```

---

## GET /api/last-trades/performance

–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ executor'–æ–≤.

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
curl "http://localhost:8083/api/last-trades/performance"
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **LastTradesController** - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è —Å–¥–µ–ª–æ–∫
- **LastTradesService** - —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–¥–µ–ª–æ–∫
- **CachedInstrumentService** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- **SystemLogRepository** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π

### –ü—É–ª –ø–æ—Ç–æ–∫–æ–≤
- **lastTradesApiExecutor** - –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
- **lastTradesBatchExecutor** - –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **lastTradesProcessingExecutor** - –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **TaskId** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- **–§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤ system_logs
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- **T-INVEST API** - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Å–¥–µ–ª–∫–∞—Ö
- **CachedInstrumentService** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ó–∞–≥—Ä—É–∑–∫–∞ —Å–¥–µ–ª–æ–∫
```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (POST)
curl -X POST "http://localhost:8083/api/last-trades" \
  -H "Content-Type: application/json" \
  -d '{"figis": ["BBG004730N88", "BBG004730ZJ9"]}'

# –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (GET)
curl "http://localhost:8083/api/last-trades?figis=BBG004730N88,BBG004730ZJ9"

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ –∞–∫—Ü–∏–π
curl "http://localhost:8083/api/last-trades/shares"

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ —Ñ—å—é—á–µ—Ä—Å–æ–≤
curl "http://localhost:8083/api/last-trades/futures"
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
curl "http://localhost:8083/api/status/{taskId}"

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
curl "http://localhost:8083/api/system/logs?taskId={taskId}"

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
curl "http://localhost:8083/api/last-trades/performance"
```

---

## ‚ö†Ô∏è –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤

### –£—Å–ø–µ—à–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- **200 OK** - –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ

### –û—à–∏–±–∫–∏
- **500 Internal Server Error** - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫
```json
{
  "success": false,
  "message": "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫: Connection timeout",
  "taskId": "LAST_TRADES_12345678",
  "timestamp": "2024-01-15T18:30:00"
}
```

---

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
1. **–ó–∞–ø—Ä–æ—Å** - POST/GET –∑–∞–ø—Ä–æ—Å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è taskId** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞–ø–∏—Å—å –≤ system_logs
4. **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
5. **–û—Ç–≤–µ—Ç** - –≤–æ–∑–≤—Ä–∞—Ç taskId –∫–ª–∏–µ–Ω—Ç—É
6. **–û–±—Ä–∞–±–æ—Ç–∫–∞** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
7. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ –ª–æ–≥–∞—Ö

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
1. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞–ø–∏—Å—å –æ—à–∏–±–æ–∫ –≤ system_logs
3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** - –≤–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ –∫–ª–∏–µ–Ω—Ç—É
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –æ—à–∏–±–æ–∫
