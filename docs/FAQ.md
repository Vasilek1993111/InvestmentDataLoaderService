# Часто задаваемые вопросы (FAQ)

## Общие вопросы

### Q: Что такое Ingestion Service?

**A:** Ingestion Service - это Spring Boot приложение для автоматического сбора и хранения данных о российских акциях и фьючерсах через API Тинькофф Инвестиций. Сервис предоставляет REST API для доступа к собранным данным.

### Q: Какие данные собирает сервис?

**A:** Сервис собирает:
- Информацию об акциях (тикер, название, валюта, биржа)
- Информацию о фьючерсах (тикер, базовый актив, валюта, биржа)
- Цены закрытия инструментов
- Торговые расписания
- Статусы торговли

### Q: Как часто обновляются данные?

**A:** 
- Цены закрытия автоматически собираются каждый день в 20:00 по московскому времени
- Справочная информация об инструментах обновляется при каждом запросе
- Торговые расписания и статусы получаются в реальном времени

## Установка и настройка

### Q: Какие системные требования?

**A:** 
- Java 21 или выше
- PostgreSQL 12 или выше
- Минимум 4 GB RAM
- 20 GB свободного места на диске
- Доступ к интернету

### Q: Как получить токен API Тинькофф?

**A:** 
1. Зарегистрируйтесь в [Тинькофф Инвестиции](https://www.tinkoff.ru/invest/)
2. Войдите в личный кабинет
3. Перейдите в раздел "Настройки" → "API"
4. Создайте новый токен
5. Скопируйте токен в конфигурацию приложения

### Q: Как настроить базу данных?

**A:** 
```sql
-- Создание базы данных
CREATE DATABASE postgres;

-- Создание схемы для рыночных данных
CREATE SCHEMA invest;

-- Создание пользователя
CREATE USER postgres WITH PASSWORD 'your_password';

-- Предоставление прав
GRANT ALL PRIVILEGES ON DATABASE postgres TO postgres;
GRANT ALL PRIVILEGES ON SCHEMA invest TO postgres;
```

### Q: Как изменить порт приложения?

**A:** Отредактируйте файл `application.properties`:
```properties
server.port=8083
```

## Использование API

### Q: Как получить список всех акций?

**A:** 
```bash
curl http://localhost:8083/shares
```

### Q: Как отфильтровать акции по бирже?

**A:** 
```bash
curl "http://localhost:8083/shares?exchange=MOEX"
```

### Q: Как получить цены закрытия для конкретных инструментов?

**A:** 
```bash
curl "http://localhost:8083/close-prices?instrumentId=BBG000B9XRY4&instrumentId=BBG000B9XRY5"
```

### Q: Как получить торговое расписание?

**A:** 
```bash
curl "http://localhost:8083/trading-schedules?exchange=MOEX&from=2024-01-01T00:00:00Z&to=2024-01-07T00:00:00Z"
```

### Q: Что означает FIGI?

**A:** FIGI (Financial Instrument Global Identifier) - это уникальный идентификатор финансового инструмента, используемый в API Тинькофф Инвестиций. Каждая акция, облигация или фьючерс имеет свой уникальный FIGI.

## Проблемы и ошибки

### Q: Приложение не запускается, ошибка "Connection refused"

**A:** 
1. Проверьте, что PostgreSQL запущен:
   ```bash
   sudo systemctl status postgresql
   ```
2. Проверьте настройки подключения в `application.properties`
3. Убедитесь, что база данных создана и доступна

### Q: Ошибка "Invalid token" при запросах к API

**A:** 
1. Проверьте правильность токена в `application.properties`
2. Убедитесь, что токен активен в личном кабинете Тинькофф
3. Проверьте, что токен не истек

### Q: Данные не обновляются автоматически

**A:** 
1. Проверьте, что планировщик включен (`@EnableScheduling`)
2. Убедитесь, что cron выражение корректно: `0 0 20 * * *`
3. Проверьте логи приложения на наличие ошибок
4. Убедитесь, что часовой пояс настроен правильно: `Europe/Moscow`

### Q: Медленная работа API

**A:** 
1. Проверьте индексы в базе данных
2. Увеличьте размер heap памяти JVM
3. Оптимизируйте запросы к базе данных
4. Рассмотрите возможность кэширования

### Q: Ошибка "Out of memory"

**A:** 
1. Увеличьте размер heap памяти:
   ```bash
   java -Xmx2g -Xms1g -jar app.jar
   ```
2. Проверьте, нет ли утечек памяти
3. Увеличьте системную память

## Расширение функциональности

### Q: Как добавить новый тип инструмента?

**A:** 
1. Создайте новую сущность в пакете `entity/`
2. Добавьте репозиторий в пакете `repository/`
3. Реализуйте сервис в пакете `service/`
4. Создайте контроллер в пакете `controller/`
5. Добавьте соответствующие DTO

### Q: Как изменить расписание сбора данных?

**A:** Отредактируйте cron выражение в `ClosePriceSchedulerService`:
```java
@Scheduled(cron = "0 0 20 * * *", zone = "Europe/Moscow")
```

### Q: Как добавить аутентификацию?

**A:** 
1. Добавьте зависимость Spring Security в `pom.xml`
2. Создайте конфигурацию безопасности
3. Настройте аутентификацию для нужных endpoints

### Q: Как добавить мониторинг и метрики?

**A:** 
1. Добавьте Spring Boot Actuator:
   ```xml
   <dependency>
       <groupId>org.springframework.boot</groupId>
       <artifactId>spring-boot-starter-actuator</artifactId>
   </dependency>
   ```
2. Настройте endpoints в `application.properties`
3. Интегрируйте с Prometheus и Grafana

## Производительность

### Q: Сколько запросов в секунду может обработать сервис?

**A:** Производительность зависит от:
- Мощности сервера
- Настройки JVM
- Оптимизации базы данных
- Сетевой пропускной способности

В среднем сервис может обрабатывать 100-1000 запросов в секунду.

### Q: Как оптимизировать производительность?

**A:** 
1. Настройте пул соединений с базой данных
2. Добавьте индексы в базу данных
3. Используйте кэширование
4. Оптимизируйте JVM параметры
5. Используйте асинхронную обработку

### Q: Как мониторить производительность?

**A:** 
1. Используйте Spring Boot Actuator
2. Настройте логирование производительности
3. Интегрируйте с системами мониторинга (Prometheus, Grafana)
4. Используйте профилирование JVM

## Безопасность

### Q: Безопасно ли хранить токен в конфигурации?

**A:** Нет, для продакшн среды рекомендуется:
1. Использовать переменные окружения
2. Шифровать чувствительные данные
3. Использовать секреты в Kubernetes
4. Регулярно обновлять токены

### Q: Как защитить API от несанкционированного доступа?

**A:** 
1. Добавьте аутентификацию (JWT, OAuth2)
2. Настройте rate limiting
3. Используйте HTTPS
4. Настройте CORS политики
5. Логируйте все запросы

### Q: Как обеспечить безопасность базы данных?

**A:** 
1. Используйте сильные пароли
2. Ограничьте доступ к базе данных
3. Регулярно обновляйте PostgreSQL
4. Настройте брандмауэр
5. Используйте SSL соединения

## Развертывание

### Q: Как развернуть в Docker?

**A:** 
1. Создайте Dockerfile
2. Настройте docker-compose.yml
3. Запустите:
   ```bash
   docker-compose up -d
   ```

### Q: Как развернуть в Kubernetes?

**A:** 
1. Создайте ConfigMap и Secret
2. Настройте Deployment и Service
3. Примените конфигурации:
   ```bash
   kubectl apply -f k8s/
   ```

### Q: Как настроить автоматическое масштабирование?

**A:** 
1. Настройте HorizontalPodAutoscaler
2. Добавьте метрики для масштабирования
3. Настройте ресурсные лимиты

### Q: Как обновить приложение без простоя?

**A:** 
1. Используйте Rolling Update в Kubernetes
2. Настройте Blue-Green deployment
3. Используйте Canary deployment

## Поддержка

### Q: Где найти логи приложения?

**A:** 
- Консоль при запуске из IDE
- Файл логов (если настроен)
- Systemd журнал: `journalctl -u ingestion-service`
- Docker логи: `docker-compose logs app`

### Q: Как включить отладочные логи?

**A:** Добавьте в `application.properties`:
```properties
logging.level.com.example.ingestionservice=DEBUG
logging.level.org.springframework.web=DEBUG
```

### Q: Как получить помощь при проблемах?

**A:** 
1. Проверьте документацию
2. Изучите логи приложения
3. Создайте Issue в репозитории проекта
4. Обратитесь к команде разработки

### Q: Как сообщить об ошибке?

**A:** При создании Issue укажите:
1. Версию приложения
2. Описание проблемы
3. Шаги для воспроизведения
4. Логи ошибок
5. Конфигурацию системы

## Планы развития

### Q: Какие функции планируются в будущем?

**A:** 
- Поддержка облигаций
- Исторические данные
- Реал-тайм котировки
- Аналитические функции
- Веб-интерфейс
- Мобильное приложение

### Q: Как предложить новую функцию?

**A:** 
1. Создайте Issue с описанием функции
2. Обсудите с командой разработки
3. Создайте Pull Request с реализацией

### Q: Как участвовать в разработке?

**A:** 
1. Форкните репозиторий
2. Создайте ветку для новой функции
3. Напишите код и тесты
4. Создайте Pull Request

## Лицензия и правовые вопросы

### Q: Какая лицензия у проекта?

**A:** [Укажите лицензию проекта]

### Q: Можно ли использовать в коммерческих проектах?

**A:** [Укажите условия использования]

### Q: Как соблюдать условия использования API Тинькофф?

**A:** 
1. Изучите документацию API Тинькофф
2. Соблюдайте лимиты запросов
3. Не нарушайте условия использования
4. Регулярно проверяйте обновления API

---

Если у вас есть дополнительные вопросы, не стесняйтесь создавать Issues в репозитории проекта или обращаться к команде разработки.